<!DOCTYPE html>
<html lang="en">
<head>
  {% include "header.html" %}
  <link rel="stylesheet" href="{{helper.cdnhost}}/assets/css/obtain.css">
  <style type="text/css">
    .about-img img{
      width: 100%;
      height: 200px;
    }
    .cou_main{
      width: 100%;
      height: 100%;
      margin-top: 30px;
      background: url({{helper.cdnhost}}/assets/img/coupon_bac.png) no-repeat;
      background-size: cover;
      padding: 0 9px;
    }
    .cou_ti{
      width: 100%;
      height: 100%;
    }
    .cou_inp{
      width: 100%;
      height: 100%;
      display: inline-block;
      background: url({{helper.cdnhost}}/assets/img/coupon_bac1.png) no-repeat;
      background-size: 100% 100%;
      margin-top: 30px;
      padding: 25px 20px;
      
    }
    .form-yimin-text {
      display: flex;
      height: 36px;
      margin-top:25px;
      position: relative;
      padding: 0 22px;
    }
  .form-yimin-text input{
    flex: 1;
    border:1px solid #dcdcdc;
    border-radius: 18px;
    padding: 0 15px;
    font-size: 13px;
    color:#333;
    background: #fff;
  }
  .form-yimin-text .city{
    flex: 1;
    border:1px solid #dcdcdc;
    border-radius: 18px;
    padding: 0 15px;
    font-size: 13px;
    color: #888;
    background: #fff;
    line-height: 36px;
  }
  .form-yimin-text input.err {
    border: 1px solid #d51821;
  }
  .form-yimin-text span{
    width: 100px;
    height: 34px;
    background: #f05373;
    border-radius: 18px;
    color:#ffffff;
    font-size: 13px;
    line-height: 34px;
    text-align: center;
    margin-left: 10px;
  }
  .form-yimin-text em{
    color: #d51821;
    font-size: 11px;
    position: absolute;
    left: 37px;
    top: 40px;
    display: none;
  }
  .form-yimin-text i{
    width: 10px;
    position: absolute;
    right: 37px;
    top: 10px;
  }
  .form-yimin-text .cou_city{
    width: 100%;
    height: 283px;
    background: url({{helper.cdnhost}}/assets/img/coupon_cit.png) no-repeat;
    background-size: 100% 100%;
    position: absolute;
    top: 37px;
    left: 0px;
    z-index: 1000;
    display: none;
  }
  .form-yimin-text .cou_city_s{
    font-size: 0;
    padding: 20px 10px 10px 12px;    
  }
  .form-yimin-text .cou_city_s span{
    width: 21%;
    height: 27px;
    display: inline-block;
    border: 1px #dcdcdc solid;
    border-radius: 2px;
    color: #999;
    font-size: 12px;
    text-align: center;
    line-height: 24px;
    background: #fff;
    margin-bottom: 10px;
    margin-left: 3%;
  }
  .form-yimin-text .cou_city_s span.active{
    border: 1px #d51821 solid;
    color: #d51821;
  }
  .form-yimin-text .cou_city_b{
    width: 100%;
    text-align: center;
    margin-top: -10px;
  }
  .form-yimin-text .cou_city_b span{
    width: 50px;
    height: 28px;
    display: inline-block;
    border: 1px #d51821 solid;
    border-radius: 2px;
    background: #d51821;
    color: #fff;
    font-size: 14px;
    text-align: center;
    line-height: 26px;
    margin-right: 25px;
  }
  .form-yimin-text .cou_city_b span.quxiao{
    background: #fff;
    color: #d51821;
    margin-right: 0px;
  }
  .cou_act{
    width: 100%;
    margin-top: 30px;
    font-size: 12px;
    color: #db1e87;
  }
  .cou_act_t{
    font-size: 14px;
  }
  .cou_act_c{
    margin-top: 15px;
    margin-bottom: 10px;
  }
  .cou_act_c1{
    line-height: 25px;
  }
  .cou_act_c1 span{
    float: left;
    display: inline-block;
    line-height: 26px;
  }
  .weui-agree__checkbox:checked:before{
    color: #e83a56;
    border: 1px solid #e83a56;
    border-radius: 3px;
    width: 13px;
    height: 15px;
    top: 39%;
    left: 50%;
  }
  .weui-agree{
    padding: 10px 0px 20px 22px;
  }
  .weui-agree__text{
    color: #e83a56;
  }
  .form-yimin-btn{
    width: 100%;
    height: 36px;
    padding: 0 22px;
    position: relative;
  }
  .form-yimin-btn span{
    width: 100%;
    color:#ffffff;
    background: url({{helper.cdnhost}}/assets/img/coupon_but.png) no-repeat;
    background-size: 100% 100%;
    height: 36px;
    line-height: 36px;
    text-align: center;
    font-size: 14px;
    display: inline-block;
  }
  .main_dialog{
    display: none;
  }
  .dialog_show{
    width: 20px;
    font-size: 20px;
    height: 20px;
    color: #fff;
    position: absolute;
    top: -180%;right: 5px;
    background: url({{helper.cdnhost}}/assets/img/coupon_close.png) no-repeat;
    background-size: 100% 100%;
  }
  </style>
</head>
<body style="background: #ffffff;">
    {% include "m_widget/top/common_top.html" %}
    <div id="app" style="background: #ffffff;">
      {# 广告位 #}
      <div style="width:100%;overflow: hidden;background:#f2aaaa">
        <div id="XC_MOBILE_PROFILE_SEAT1" class="about-img">
          <a rel="nofollow" data-pid="{{about[0].pid}}" href="{{about[0].linkurl}}" >
            <img src="{{about[0].imageurl}}" alt="{{about[0].alt}}">
          </a>
        </div>
      </div>
      <div class="cou_main">
        {# 活动介绍 #}
        <img src="{{helper.cdnhost}}/assets/img/coupon_ti.png" alt="" class="cou_ti">
        {# 填写个人信息 #}
        <div class="cou_inp">
            <div class="form-yimin-text" style="margin-top: 60px;"><input type="text" placeholder="请输入您的真实姓名" id="name"><em id="name_error">请输入正确姓名</em></div>
            <div class="form-yimin-text" ><input type="text" placeholder="请输入手机号" id="phone"><em id="phone_error">请输入正确手机号</em></div>
            <div class="form-yimin-text"><input type="text" id="code" placeholder="请输入验证码"><span id="getcode" data-coupon="{{param_code}}">点击发送验证码</span><em id="code_error">请输入正确手机验证码</em></div>
            <div class="form-yimin-text form-yimin-text1">
              <div class="city" id="city">意向国家</div>
              {#<input type="text" id="city" placeholder="意向国家">#}
              <i class="iconfont">&#xe60a;</i>
              <div class="cou_city" id="cou_city">
                <div class="cou_city_s" id="cou_city_s">
                  <span class="active" value='1'>美国</span>
                  <span value='2'>英国</span>
                  <span value='4'>澳大利亚</span>
                  <span value='3'>加拿大</span>
                  <span value='5'>新西兰</span>
                  <span value='51'>日本</span>
                  <span value='50'>韩国</span>
                  <span value='54'>中国香港</span>
                  <span value='100'>俄罗斯</span>
                  <span value='101'>乌克兰</span>
                  <span value='108'>爱尔兰</span>
                  <span value='111'>意大利</span>
                  <span value='112'>西班牙</span>
                  <span value='102'>白俄罗斯</span>
                  <span value='52'>新加坡</span>
                  <span value='53'>马来西亚</span>
                  <span value='110'>丹麦</span>
                  <span value='103'>德国</span>
                  <span value='104'>法国</span>
                  <span value='105'>挪威</span>
                  <span value='106'>瑞典</span>
                  <span value='107'>芬兰</span>
                  <span value='109'>荷兰</span>
                  <span value='113'>瑞士</span>
                </div>
                <div class="cou_city_b">
                  <span id="city_queding">确认</span>
                  <span class="quxiao" id="city_quxiao">取消</span>
                </div>
              </div>
            </div>
            <label for="weuiAgree" class="weui-agree">
              <input id="weuiAgree" type="checkbox" class="weui-agree__checkbox" checked="checked">
              <span class="weui-agree__text">注册JJL网站账号</span>
          </label>
          <div class="form-yimin-btn"><span id="evaluationBtn">点击获取优惠码</span></div>
        </div>
        {# 活动说明 #}
        {#<div class="cou_act">
          <div class="cou_act_t">活动说明</div>
          <div class="cou_act_c">活动范围：全国49家分子公司</div>
          <div class="cou_act_c1">活动时间：2018年6月10日至2018年8月25日</div>
          <div class="cou_act_c1"><span>参与规则：</span>凡在各分子公司夏展举办日前夕领取优惠码，并在展会举办日现场使用优惠码，此码有效期截止至2018年9月25日。</div>
          <div class="cou_act_c1"><span>使用条件：</span>全款签约最高减免2000元服务费，个别国家根据实际情况进行服务费减免，最终解释权归金吉列留学所有。</div>
        </div>#}
        <img src="{{helper.cdnhost}}/assets/img/coupon_ti1.png" alt="" class="cou_ti" style="margin: 30px 0px">
      </div>
      {% include "m_widget/footer/common_footer.html" %}
    </div>

    {# 分享弹层 #}
    <div class="main_dialog" style="">
      
      <div class="obtain_ing"></div>
    <div class="js_dialog" id="dialog1" style="opacity: 1;position: relative">
      <div class="weui-mask"></div>
      
      <div class="weui-dialog" style="overflow: inherit;">
        <div id="dialog_show" class="dialog_show"></div>
        <p class="share_con">分享至</p>
        <div class="wenxin_con_xin"></div>
        <div class="wenxin_con" ></div>
        <div class="cue_qq_con"></div>
      </div>
      <div class="cue_weixin">
        <div></div>
      </div>
      <div class="cue_weixin1">
        <div></div>
      </div>
      <div class="cue_qq">
        <div></div>
      </div>
      <div class="cue_weixincon">
        <div></div>
      </div>
    </div>
  </div>

<!-- ===侧边栏==== -->
{% include "m_widget/slidebar/slidebar.html" %}
<!-- ======乐语底栏======= -->
{% include 'm_widget/funtalk/funtalk.html' %}
</body>
<!-- <script src="{{helper.cdnhost}}/assets/js/online_evaluation_yimin.js"></script> -->

<script>

  var check_value = {
    phone: function(phone){
        if(!/^1\d{10}$/.test(phone)){
            return false;
        }
        return true;
    }
};
// $('#name').on('blur', function () {
//     checkName();
    
// });
// $('#name').on('keyup', function () {
//     checkName();
    
// });
// $('#phone').on('blur', function () {
//     checkPhone();
    
// });
// $('#phone').on('keyup', function () {
//     checkPhone();
    
// });
// $('#code').on('blur', function () {
    
//     checkCodeValue();
// });
// $('#code').on('keyup', function () {
//     checkCodeValue();
    
// });
$('#city').on('click', function () {
  $('#city').focus().addClass('err');
  $('#cou_city_s').find('span').first().addClass('active').siblings().removeClass('active');
  $('#cou_city').show();
  $('#city').html('美国');
});
function getcity () {
    var city = $.trim($('#city').html());
    if (city != '美国' && city != '英国' && city != '澳大利亚' && city != '加拿大' && city != '新西兰' && city != '日本' && city != '韩国' && city != '中国香港' && city != '俄罗斯' && city != '乌克兰' && city != '爱尔兰' && city != '意大利' && city != '西班牙' && city != '白俄罗斯' && city != '新加坡' && city != '马来西亚' && city != '丹麦' && city != '德国' && city != '法国' && city != '挪威' && city != '瑞典' &&city != '芬兰' && city != '荷兰' && city != '瑞士') {
      $('#city').focus().addClass('err');
      $('#cou_city').show();
      return false;
    } 
    else {
      $('#city').removeClass('err');
      $('#cou_city').hide();
      return true;
    }
    
}
function checkName () {
    $('#city').removeClass('err');
    $('#cou_city').hide();
    var name = $.trim($('#name').val());
    if (name == '') {
        $('#name').focus().addClass('err');
        $('#name_error').show();
        $('#name').val('');
        return false;
    }
    else {
        $('#name').removeClass('err');
        $('#name_error').hide();
        return true;
    }
}
function checkPhone () {
    $('#city').removeClass('err');
    $('#cou_city').hide();
    var phoneNum = $.trim($('#phone').val());
    if (!check_value.phone(phoneNum)) {
        $('#phone').focus().addClass('err');
        $('#phone_error').show();
        
        return false;
    }
    else {
        $('#phone').removeClass('err');
        $('#phone_error').hide();
        return true;
    }
}
function checkCodeValue () {
    $('#city').removeClass('err');
    $('#cou_city').hide();
    var codeVal = $('#code').val();
    if (codeVal == '' || codeVal.length < 6) {
        $('#code').focus().addClass('err');
        $('#code_error').show();
        
        return false;
    } else {
        $('#code').removeClass('err');
        $('#code_error').hide();
        return true;
    }
}
    var timer;
    function countDown() {
        // 60s倒计时
        // $("#getcode").attr('disabled',"true");
        $("#getcode").unbind("click");
        var countDownTime = 60;
        timer = window.setInterval(function () {
            countDownTime--;
            $("#getcode").html('（'+countDownTime+'）s');
            if (countDownTime == 0) {
                clearInterval(timer);
                $("#getcode").html('点击发送验证码');
                // $("#getcode").removeAttr("disabled");
                $("#getcode").bind("click",function () {
                  getCode();
                });
            }
        }, 1000);
    }

    function getCode () {
      var data = $('#getcode').data('coupon');
      console.log('data',data)
      if (!checkPhone()) {
        return false;
      }
      $.ajax({
          url: '/sendSms',
          type:'get',
          data:{
              param_code: data,
              phone:$("#phone").val()
          },
          dataType:'json',
          success:function(msg){
              if(msg.code === 0){
              //alert('成功');
              countDown();
              } else {
                  alert('出错啦');
              }
          },
          error:function(XMLHttpRequest, textStatus, errorThrown){
              console.log("获取失败，请重试！CODE:"+XMLHttpRequest.status)
          }
      });
    }
    function isWeiXin() {
        // 检查微信环境
        var ua = window.navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
          return true;
        } else {
          return false;
        }
      }
    $('#getcode').on('click', function () {
        getCode();
        return false;
    });
    $('#cou_city_s').on('click', 'span', function (e) {
        e.preventDefault();
        var cou_cityid = $(this).attr('value');
        console.log(cou_cityid)
		    $(this).addClass('active').siblings().removeClass('active')
        $('#city').html($(this).html());
        $('#city').attr('data-city', cou_cityid)
        return false;
    });
    $('#city_queding').on('click', function (e) {
      e.preventDefault();
      var city = $.trim($('#city').html());
      if (city != '美国' && city != '英国' && city != '澳大利亚' && city != '加拿大' && city != '新西兰' && city != '日本' && city != '韩国' && city != '中国香港' && city != '俄罗斯' && city != '乌克兰' && city != '爱尔兰' && city != '意大利' && city != '西班牙' && city != '白俄罗斯' && city != '新加坡' && city != '马来西亚' && city != '丹麦' && city != '德国' && city != '法国' && city != '挪威' && city != '瑞典' &&city != '芬兰' && city != '荷兰' && city != '瑞士') {
        return false;
      } else {
        $('#cou_city').hide();
        $('#city').removeClass('err');
      }
      
      // return false;
    });
    $('#city_quxiao').on('click', function (e) {
      e.preventDefault();
      $('#cou_city').hide();
      $('#city').html('意向国家');
      $('#city').removeClass('err');
      return false;
    });
    $('#evaluationBtn').on('click', function () {
        if (!checkName()) return false;
        if (!checkPhone()) return false;
        if (!checkCodeValue()) return false;
        if (!getcity()) return false;
        var cityid = $('#city').data('city');
        $.ajax({
          url: '/getCoupons',
          type: 'get',
          data: {
            user_name: $('#name').val(),
            mobile: $("#phone").val(),
            country_id: cityid,
            code: $('#code').val()
          },
          dataType:'json',
          success:function(msg){
            if(msg.code === 0){
                //alert('成功');
                alert('优惠码发送成功');
                if (isWeiXin()) {
                  window.location.href = js_api_config.wwhost + '/obtain'  
                } else {
                  $('.main_dialog').show();
                }
                
            } else {
                alert(msg.massage);
            }
          },
          error:function(XMLHttpRequest, textStatus, errorThrown){
            console.log("获取失败，请重试！CODE:"+XMLHttpRequest.status)
          }
        })
    });
    
    //在浏览器中弹层的提示框
        $('#dialog_show').on('click', function () {
          $('.main_dialog').hide();
          window.location.reload();
        });
        $('.wenxin_con').on('click',function(e){
          e.stopPropagation();
          this.flag=!this.flag;
          if(this.flag) {
            $('.cue_weixin1').css("display","block");
          }else{
            $('.cue_weixin1').css("display","none");
          }
        });
        $('.cue_qq_con').on('click',function(e){
          e.stopPropagation();
          this.flag=!this.flag;
          if(this.flag) {
            $('.cue_weixin1').css("display","block");
          }else{
            $('.cue_weixin1').css("display","none");
          }
        });
        $('.wenxin_con_xin').on('click',function(e){
          e.stopPropagation();
          this.flag=!this.flag;
          if(this.flag) {
            $('.cue_weixin1').css("display","block");
          }else{
            $('.cue_weixin1').css("display","none");
          }
        });
        $(document).on('click touchstart', function (){
          if($('.cue_weixin1').css("display")=='block'){
            $('.cue_weixin1').css("display","none");
          }
        });
</script>
</html>